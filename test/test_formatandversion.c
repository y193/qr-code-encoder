#include "formatandversion.h"
#include "test_module.h"
#include "typedefs.h"
#include <assert.h>
#include <stdio.h>
#include <stdlib.h>

static void test_placeFormatInformation(void) {
    size_t symbolSize = 21;
    uint8_t *matrix = malloc(symbolSize * symbolSize * sizeof(uint8_t));

    const uint8_t *input = (const uint8_t *)"111111102101101111111"
                                            "100000102111101000001"
                                            "101110102000001011101"
                                            "101110102100001011101"
                                            "101110102011101011101"
                                            "100000102000101000001"
                                            "111111101010101111111"
                                            "000000002001100000000"
                                            "222222122100122222222"
                                            "000101011010100101100"
                                            "001000110101010011111"
                                            "000010000100000111100"
                                            "000111111001010010000"
                                            "000000001011111001100"
                                            "111111102110101100000"
                                            "100000102011111000101"
                                            "101110102000100101100"
                                            "101110102100100100000"
                                            "101110102011010010100"
                                            "100000102000000110110"
                                            "111111102111010010100";

    initializeMatrix(matrix, input, symbolSize);

    placeFormatInformation(matrix, symbolSize, ERROR_CORRECTION_LEVEL_M, 2);

    const uint8_t *expected = (const uint8_t *)"111111100101101111111"
                                               "100000100111101000001"
                                               "101110101000001011101"
                                               "101110101100001011101"
                                               "101110101011101011101"
                                               "100000101000101000001"
                                               "111111101010101111111"
                                               "000000001001100000000"
                                               "101111100100101111100"
                                               "000101011010100101100"
                                               "001000110101010011111"
                                               "000010000100000111100"
                                               "000111111001010010000"
                                               "000000001011111001100"
                                               "111111100110101100000"
                                               "100000101011111000101"
                                               "101110101000100101100"
                                               "101110101100100100000"
                                               "101110101011010010100"
                                               "100000100000000110110"
                                               "111111101111010010100";

    matrixEquals(matrix, expected, symbolSize);

    printf("test_placeFormatInformation() passed\n");
}

static void test_placeVersionInformation(void) {
    size_t symbolSize = 45;
    uint8_t *matrix = malloc(symbolSize * symbolSize * sizeof(uint8_t));

    const uint8_t *input =
        (const uint8_t *)"111111102000000000000000000000000022201111111"
                         "100000102000000000000000000000000022201000001"
                         "101110102000000000000000000000000022201011101"
                         "101110102000000000000000000000000022201011101"
                         "101110102000000000001111100000000022201011101"
                         "100000102000000000001000100000000022201000001"
                         "111111101010101010101010101010101010101111111"
                         "000000002000000000001000100000000000000000000"
                         "222222122000000000001111100000000000022222222"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000011111000000000001111100000000000111110000"
                         "000010001000000000001000100000000000100010000"
                         "000010101000000000001010100000000000101010000"
                         "000010001000000000001000100000000000100010000"
                         "000011111000000000001111100000000000111110000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "222222100000000000000000000000000000000000000"
                         "222222000000000000000000000000000000000000000"
                         "222222100000000000001111100000000000111110000"
                         "000000001000000000001000100000000000100010000"
                         "111111102000000000001010100000000000101010000"
                         "100000102000000000001000100000000000100010000"
                         "101110102000000000001111100000000000111110000"
                         "101110102000000000000000000000000000000000000"
                         "101110102000000000000000000000000000000000000"
                         "100000102000000000000000000000000000000000000"
                         "111111102000000000000000000000000000000000000";

    initializeMatrix(matrix, input, symbolSize);

    placeVersionInformation(matrix, symbolSize, 7);

    const uint8_t *expected =
        (const uint8_t *)"111111102000000000000000000000000000101111111"
                         "100000102000000000000000000000000001001000001"
                         "101110102000000000000000000000000001001011101"
                         "101110102000000000000000000000000001101011101"
                         "101110102000000000001111100000000011101011101"
                         "100000102000000000001000100000000000001000001"
                         "111111101010101010101010101010101010101111111"
                         "000000002000000000001000100000000000000000000"
                         "222222122000000000001111100000000000022222222"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000011111000000000001111100000000000111110000"
                         "000010001000000000001000100000000000100010000"
                         "000010101000000000001010100000000000101010000"
                         "000010001000000000001000100000000000100010000"
                         "000011111000000000001111100000000000111110000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000000100000000000000000000000000000000000000"
                         "000000000000000000000000000000000000000000000"
                         "000010100000000000000000000000000000000000000"
                         "011110000000000000000000000000000000000000000"
                         "100110100000000000001111100000000000111110000"
                         "000000001000000000001000100000000000100010000"
                         "111111102000000000001010100000000000101010000"
                         "100000102000000000001000100000000000100010000"
                         "101110102000000000001111100000000000111110000"
                         "101110102000000000000000000000000000000000000"
                         "101110102000000000000000000000000000000000000"
                         "100000102000000000000000000000000000000000000"
                         "111111102000000000000000000000000000000000000";

    matrixEquals(matrix, expected, symbolSize);

    printf("test_placeVersionInformation() passed\n");
}

int main(void) {
    test_placeFormatInformation();
    test_placeVersionInformation();

    return 0;
}
